(function(g){g.fn.wallyti=function(d){var k={blockMaxWidth:360,blockMinWidth:240,blockMargin:35,delayOnResize:60,disableTransitions:!1,cssTransition:"all 0.2s ease-in-out",onComplete:function(){}},a={},a="function"==typeof d?g.extend(k,{onComplete:d}):"object"!=typeof d?k:g.extend(k,d);return this.each(function(){function d(){setTimeout(function(){w==g(document).height()>g(window).height()&&n==b.outerWidth()||b.wallyti(a)},100);a.onComplete()}function k(){v||(v=0==--x)&&d()}var p,l,q,f,r,h=[],m=[],
e=[],t=1,b=g(this),e=b.children(),x=f=e.length,v=!1,u="all 0s ease 0s"!=e.css("transition")&&""!=e.css("transition")&&0!=e.css("transition").length;b.addClass("wallyti-container").css({"-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box",position:"relative",padding:"0"});e.addClass("wallyti-block").css({"-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box",position:"absolute",visibility:"hidden"});if(a.cssTransition&&40>=f&&
!a.disableTransitions)e.css({"-webkit-transition":a.cssTransition,"-moz-transition":a.cssTransition,"-o-transition":a.cssTransition,transition:a.cssTransition}),u=!0;else if(40<f||a.disableTransitions)e.css({"-webkit-transition":"none","-moz-transition":"none","-o-transition":"none",transition:"none"}),u=!1;var n=b.outerWidth(),w=g(document).height()>g(window).height();f=b.attr("wallyti-block-max")?parseInt(b.attr("wallyti-block-max")):a.blockMaxWidth;r=b.attr("wallyti-block-min")?parseInt(b.attr("wallyti-block-min")):
a.blockMinWidth;q=b.attr("wallyti-block-margin")?parseInt(b.attr("wallyti-block-margin")):a.blockMargin;for(c=Math.floor(n/r)+2;0<c;c--)if(p=Math.floor(n/c+q/c),l=p-q,l<r?m[c]="narrow":l>f&&(m[c]="wide"),"narrow"==m[c+1]&&"wide"==m[c]){m[t=c]="ok";break}else if(l>=r&&l<=f){m[t=c]="ok";break}for(c=0;c<t;c++)h[c]=0;e.each(function(){var a=g(this),e,d=1<t?h.indexOf(Math.min.apply(Math,h)):0,f={top:h[d],left:0<=d*p?d*p:0,width:l};cloned=a.clone();cloned.css(f).css("visibility","hidden").addClass("cloned").appendTo(b);
e=cloned.outerHeight();h[d]+=e+q;cloned.remove();if(u&&a.css("top")!=f.top&&a.css("left")!=f.left)a.addClass("wallyti-moving").off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(b){a.removeClass("wallyti-moving");k()});a.css("visibility","visible");a.css(f);u&&"1"==parseInt(b.data("wallyti-executed"))||k()});b.height(Math.max.apply(Math,h));g(window).off("resize.wallyti").on("resize.wallyti",
function(){clearTimeout(window.resizedFinished);window.resizedFinished=setTimeout(function(){n!=b.outerWidth()&&b.wallyti(a)},a.delayOnResize)});b.data("wallyti-executed","1")})}})(jQuery);